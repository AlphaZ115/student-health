{% extends "base.html" %}

{% block content %}
<h2 class="mb-3">‚ö†Ô∏è BMI Analysis - Abnormal Cases</h2>

<div class="alert alert-info">
    <strong>BMI Categories:</strong>
    <ul class="mb-0">
        <li>Underweight: BMI &lt; 18.5</li>
        <li>Normal: 18.5 ‚â§ BMI ‚â§ 25</li>
        <li>Overweight: BMI &gt; 25</li>
    </ul>
</div>

<div class="card mb-3">
    <div class="card-body">
        <form method="GET" action="/analysis/bmi">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="show_all" value="true" id="showAllCheck" {% if
                    show_all %}checked{% endif %} onchange="this.form.submit()">
                <label class="form-check-label" for="showAllCheck">
                    Show all abnormal records (default: show only latest record per student)
                </label>
            </div>
        </form>
    </div>
</div>

{% if records %}
<table class="table table-striped">
    <thead>
        <tr>
            <th>Student Name</th>
            <th>Class</th>
            <th>Check Date</th>
            <th>Height (m)</th>
            <th>Weight (kg)</th>
            <th>BMI</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        {% for r in records %}
        <tr>
            <td><a href="/health/{{ r.MaHS }}">{{ r.TenHS }}</a></td>
            <td>{{ r.Lop }}</td>
            <td>{{ r.NgayKham }}</td>
            <td>{{ "%.2f"|format(r.ChieuCao) }}</td>
            <td>{{ "%.1f"|format(r.CanNang) }}</td>
            <td><strong>{{ "%.1f"|format(r.BMI) }}</strong></td>
            <td>
                {% if r.BMI < 18.5 %} <span class="badge bg-warning">‚ö†Ô∏è Underweight</span>
                    {% else %}
                    <span class="badge bg-danger">‚ö†Ô∏è Overweight</span>
                    {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<p class="text-muted">Total abnormal cases: {{ records|length }}{% if not show_all %} (latest records only){% endif %}
</p>
{% else %}
{% if total_records == 0 %}
<div class="alert alert-info">üìã No health records available yet. Add some health records to see BMI analysis.</div>
{% else %}
<div class="alert alert-success">‚úÖ No abnormal BMI cases found!</div>
{% endif %}
{% endif %}
{% endblock %}